(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2586],{165:(e,t,a)=>{Promise.resolve().then(a.bind(a,8940))},8940:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ev});var s=a(5155),r=a(2115),l=a(6046),n=a(4085),i=a(2336),d=a(5007),c=a(745),o=a(5785),u=a(1594),h=a(853),x=a(1556),m=a(4505),v=a(9677),p=a(9286),f=a(3670),g=a(2079),j=a(719),N=a(4857),b=a(5686),y=a(4081),w=a(2598),S=a(6764);let k="archive-table-column-widths";function C(e){try{let e=localStorage.getItem(k);if(e){let t=JSON.parse(e);return new Map(Object.entries(t))}}catch(e){console.error("Failed to load column widths:",e)}return new Map}function A(e){try{let t=Object.fromEntries(e);localStorage.setItem(k,JSON.stringify(t))}catch(e){console.error("Failed to save column widths:",e)}}function z(e){let{columns:t,children:a}=e,[l,n]=(0,r.useState)(new Map),[i,d]=(0,r.useState)(null),c=(0,r.useRef)(null),o=(0,r.useRef)(0),u=(0,r.useRef)(0);(0,r.useEffect)(()=>{n(C(t))},[t]);let h=(0,r.useCallback)(e=>{var a;return l.get(e)||(null===(a=t.find(t=>t.id===e))||void 0===a?void 0:a.defaultWidth)||150},[l,t]),x=(e,t)=>{t.preventDefault(),t.stopPropagation();let a=h(e);d(e),o.current=t.clientX,u.current=a},m=(0,r.useCallback)(e=>{var a;if(!i||!l)return;let s=e.clientX-o.current,r=Math.max(u.current+s,(null===(a=t.find(e=>e.id===i))||void 0===a?void 0:a.minWidth)||50);n(e=>{let t=new Map(e);return t.set(i,r),t})},[i,t,l]),v=(0,r.useCallback)(()=>{i&&(A(l),d(null))},[i,l]);(0,r.useEffect)(()=>{if(i)return document.addEventListener("mousemove",m),document.addEventListener("mouseup",v),()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",v)}},[i,m,v]);let p=e=>{var a;let s=(null===(a=t.find(t=>t.id===e))||void 0===a?void 0:a.defaultWidth)||150;n(t=>{let a=new Map(t);return a.set(e,s),A(a),a})},f=()=>{let e=c.current;if(!e)return a;e.querySelectorAll("th[data-resizable-column]").forEach(e=>{let t=e.getAttribute("data-resizable-column");if(!t)return;let a=h(t);e.style.width="".concat(a,"px"),e.style.minWidth="".concat(a,"px"),e.style.maxWidth="".concat(a,"px");let s=e.querySelector(".resize-handle");s||((s=document.createElement("div")).className="resize-handle",s.style.cssText="\n          position: absolute;\n          right: 0;\n          top: 0;\n          bottom: 0;\n          width: 4px;\n          cursor: col-resize;\n          background: transparent;\n          transition: background 0.2s;\n        ",s.addEventListener("mouseenter",()=>{s.style.background="rgba(59, 130, 246, 0.1)"}),s.addEventListener("mouseleave",()=>{s.style.background="transparent"}),e.style.position="relative",e.appendChild(s)),s.onmousedown=e=>x(t,e),s.ondblclick=()=>p(t)}),e.querySelectorAll("tbody tr").forEach(e=>{t.forEach(t=>{let a=e.querySelector('td[data-column="'.concat(t.id,'"]'));if(a){let e=h(t.id);a.style.width="".concat(e,"px"),a.style.maxWidth="".concat(e,"px"),a.style.minWidth="".concat(e,"px")}})})};return(0,r.useEffect)(()=>{f()},[l,t,h]),(0,s.jsx)(g.XI,{ref:c,children:a})}function F(e){let{archives:t,selectedIds:a,onSelectionChange:l,onView:i,onEdit:d,onDelete:c,onBatchDelete:o,onDownload:u}=e,[h,x]=(0,r.useState)(!1),m=[{id:"select",header:"",defaultWidth:50,minWidth:50},{id:"archiveNo",header:"档号",defaultWidth:140,minWidth:100},{id:"fondsNo",header:"全宗号",defaultWidth:80,minWidth:60},{id:"year",header:"年度",defaultWidth:70,minWidth:60},{id:"retentionPeriod",header:"保管期限",defaultWidth:80,minWidth:70},{id:"title",header:"题名",defaultWidth:200,minWidth:150},{id:"deptIssue",header:"机构问题",defaultWidth:120,minWidth:80},{id:"responsible",header:"责任者",defaultWidth:80,minWidth:60},{id:"docNo",header:"文号",defaultWidth:100,minWidth:80},{id:"date",header:"日期",defaultWidth:90,minWidth:70},{id:"boxNo",header:"盒号",defaultWidth:70,minWidth:60},{id:"pieceNo",header:"件号",defaultWidth:70,minWidth:60},{id:"pageNo",header:"页号",defaultWidth:60,minWidth:50},{id:"actions",header:"操作",defaultWidth:120,minWidth:100}],v=e=>{e?l(t.map(e=>e.archiveID)):l([])},k=(e,t)=>{t?l([...a,e]):l(a.filter(t=>t!==e))},C=async()=>{if(0===a.length)return;let e=t.filter(e=>a.includes(e.archiveID)&&e.fileUrl&&""!==e.fileUrl.trim());if(console.log("[Export] Selected IDs:",a),console.log("[Export] Archives with PDF:",e.map(e=>({id:e.archiveID,no:e.archiveNo,fileUrl:e.fileUrl}))),0===e.length){alert("所选档案没有可导出的PDF文件");return}x(!0);try{let t=await fetch("/api/archives/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e.map(e=>e.archiveID)}),credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.error||"导出失败")}let a=await t.blob(),s=window.URL.createObjectURL(a),r=document.createElement("a");r.href=s;let n=t.headers.get("Content-Disposition"),i="archives_export_".concat(Date.now(),".zip");if(n){let e=n.match(/filename="?(.+)"?/i);e&&e[1]&&(i=decodeURIComponent(e[1]))}r.download=i,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r),l([])}catch(e){console.error("Export error:",e),alert(e instanceof Error?e.message:"导出失败")}finally{x(!1)}},A=e=>{if(!e)return"-";let t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("zh-CN")},F=e=>{switch(e){case"永久":return"destructive";case"长期":return"default";case"短期":return"secondary";default:return"outline"}};return(0,s.jsxs)("div",{className:"space-y-4",children:[a.length>0&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,s.jsxs)("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:["已选择 ",(0,s.jsx)("span",{className:"font-semibold",children:a.length})," 项"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(n.$,{size:"sm",variant:"default",onClick:C,disabled:h,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-2 animate-pulse"}),"导出中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"批量导出"]})}),(0,s.jsxs)(n.$,{size:"sm",variant:"destructive",onClick:()=>o(a),disabled:h,children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"批量删除"]})]})]}),(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(z,{columns:m,children:[(0,s.jsx)(g.A0,{children:(0,s.jsxs)(g.Hj,{children:[(0,s.jsx)(g.nd,{"data-resizable-column":"select",className:"text-center",children:(0,s.jsx)(f.S,{checked:t.length>0&&a.length===t.length,onCheckedChange:v,"aria-label":"全选"})}),(0,s.jsx)(g.nd,{"data-resizable-column":"archiveNo",children:"档号"}),(0,s.jsx)(g.nd,{"data-resizable-column":"fondsNo",children:"全宗号"}),(0,s.jsx)(g.nd,{"data-resizable-column":"year",children:"年度"}),(0,s.jsx)(g.nd,{"data-resizable-column":"retentionPeriod",children:"保管期限"}),(0,s.jsx)(g.nd,{"data-resizable-column":"title",children:"题名"}),(0,s.jsx)(g.nd,{"data-resizable-column":"deptIssue",children:"机构问题"}),(0,s.jsx)(g.nd,{"data-resizable-column":"responsible",children:"责任者"}),(0,s.jsx)(g.nd,{"data-resizable-column":"docNo",children:"文号"}),(0,s.jsx)(g.nd,{"data-resizable-column":"date",children:"日期"}),(0,s.jsx)(g.nd,{"data-resizable-column":"boxNo",children:"盒号"}),(0,s.jsx)(g.nd,{"data-resizable-column":"pieceNo",children:"件号"}),(0,s.jsx)(g.nd,{"data-resizable-column":"pageNo",children:"页号"}),(0,s.jsx)(g.nd,{"data-resizable-column":"actions",className:"text-right",children:"操作"})]})}),(0,s.jsx)(g.BF,{children:0===t.length?(0,s.jsx)(g.Hj,{children:(0,s.jsx)(g.nA,{colSpan:m.length,className:"text-center py-8 text-gray-500",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)(y.A,{className:"h-12 w-12 text-gray-400"}),(0,s.jsx)("p",{children:"暂无档案数据"})]})})}):t.map(e=>(0,s.jsxs)(g.Hj,{children:[(0,s.jsx)(g.nA,{"data-column":"select",className:"text-center",children:(0,s.jsx)(f.S,{checked:a.includes(e.archiveID),onCheckedChange:t=>k(e.archiveID,!0===t),"aria-label":"选择 ".concat(e.title)})}),(0,s.jsx)(g.nA,{"data-column":"archiveNo",className:"font-medium",children:(0,s.jsx)("span",{className:"font-mono text-sm block truncate",title:e.archiveNo,children:e.archiveNo})}),(0,s.jsx)(g.nA,{"data-column":"fondsNo",children:(0,s.jsx)("span",{className:"font-mono text-sm block truncate",title:e.fondsNo,children:e.fondsNo})}),(0,s.jsx)(g.nA,{"data-column":"year",children:(0,s.jsx)(p.E,{variant:"outline",children:e.year})}),(0,s.jsx)(g.nA,{"data-column":"retentionPeriod",children:(0,s.jsx)(p.E,{variant:F(e.retentionPeriod),children:e.retentionPeriod})}),(0,s.jsx)(g.nA,{"data-column":"title",children:(0,s.jsxs)("div",{className:"max-w-xs",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",title:e.title,children:e.title}),e.remark&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1 truncate",title:e.remark,children:e.remark})]})}),(0,s.jsx)(g.nA,{"data-column":"deptIssue",children:(0,s.jsx)("span",{className:"text-sm text-gray-600 block truncate",title:e.deptIssue,children:e.deptIssue||"-"})}),(0,s.jsx)(g.nA,{"data-column":"responsible",children:(0,s.jsx)("span",{className:"text-sm text-gray-600 block truncate",title:e.responsible,children:e.responsible||"-"})}),(0,s.jsx)(g.nA,{"data-column":"docNo",children:(0,s.jsx)("span",{className:"text-xs text-gray-600 font-mono block truncate",title:e.docNo,children:e.docNo||"-"})}),(0,s.jsx)(g.nA,{"data-column":"date",children:(0,s.jsx)("span",{className:"text-sm text-gray-600",children:A(e.date)})}),(0,s.jsx)(g.nA,{"data-column":"boxNo",children:(0,s.jsx)("span",{className:"text-sm text-gray-600 font-mono",children:e.boxNo})}),(0,s.jsx)(g.nA,{"data-column":"pieceNo",children:(0,s.jsx)("span",{className:"text-sm text-gray-600 font-mono",children:e.pieceNo})}),(0,s.jsx)(g.nA,{"data-column":"pageNo",children:(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.pageNo})}),(0,s.jsx)(g.nA,{"data-column":"actions",className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-1",children:[e.fileUrl&&(0,s.jsx)(n.$,{size:"icon-xs",variant:"ghost",onClick:()=>i(e),title:"预览PDF",children:(0,s.jsx)(w.A,{className:"h-3 w-3"})}),(0,s.jsx)(n.$,{size:"icon-xs",variant:"ghost",onClick:()=>d(e),title:"编辑",children:(0,s.jsx)(S.A,{className:"h-3 w-3"})}),(0,s.jsx)(n.$,{size:"icon-xs",variant:"ghost",onClick:()=>c(e.archiveID),title:"删除",children:(0,s.jsx)(b.A,{className:"h-3 w-3 text-destructive"})})]})})]},e.archiveID))})]})})]})}var _=a(789),D=a(7837),E=a(1466),W=a(2423),L=a(767),M=a(7711),P=a(247);let U=(0,M.default)(()=>a.e(245).then(a.bind(a,245)).then(e=>({default:e.PdfViewer})),{loadableGenerated:{webpack:()=>[245]},ssr:!1,loading:()=>(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)(m.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})})});function I(e){let{open:t,onOpenChange:a,archive:l}=e,[i,d]=(0,r.useState)(""),[c,o]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&(null==l?void 0:l.fileUrl)?(d(l.fileUrl),o(!1)):d("")},[t,l]);let x=async()=>{if(l&&i){h(!0);try{await (0,P.L)(l.archiveID),window.open(i,"_blank")}catch(e){console.error("Failed to log download:",e),window.open(i,"_blank")}finally{h(!1)}}},v=e=>{if(!e)return"-";let t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("zh-CN")},p=l?[{label:"档号",value:l.archiveNo,icon:y.A},{label:"全宗号",value:l.fondsNo},{label:"年度",value:l.year},{label:"保管期限",value:l.retentionPeriod},{label:"保管期限代码",value:l.retentionCode},{label:"责任者",value:l.responsible,icon:E.A},{label:"文号",value:l.docNo||"-"},{label:"日期",value:v(l.date),icon:W.A},{label:"页数",value:l.pageNo||"-"},{label:"部门",value:l.deptIssue},{label:"盒号",value:l.boxNo},{label:"件号",value:l.pieceNo},{label:"机构代码",value:l.deptCode}].filter(e=>e.value):[];return(0,s.jsx)(D.lG,{open:t,onOpenChange:a,children:(0,s.jsx)(D.Cf,{className:"p-0 overflow-hidden",style:{width:"96vw",height:"96vh",maxWidth:"96vw",maxHeight:"96vh"},children:(0,s.jsxs)("div",{className:"flex h-full",children:[(0,s.jsx)("div",{className:"w-44 border-r bg-muted/30 flex-shrink-0 overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-3 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),(0,s.jsx)(D.L3,{className:"text-sm font-semibold",children:"档案信息"})]}),(0,s.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>a(!1),children:(0,s.jsx)(L.A,{className:"h-3.5 w-3.5"})})]}),(0,s.jsx)("div",{className:"pb-3 border-b",children:(0,s.jsx)("h3",{className:"font-semibold text-base leading-tight break-words",children:(null==l?void 0:l.title)||"-"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[p.map((e,t)=>(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide",children:e.label}),(0,s.jsxs)("div",{className:"flex items-start gap-1.5",children:[e.icon&&(0,s.jsx)(e.icon,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0 mt-0.5"}),(0,s.jsx)("span",{className:"text-xs break-words",children:e.value})]})]},t)),(null==l?void 0:l.remark)&&(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wide",children:"备注"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground break-words whitespace-pre-wrap",children:l.remark})]})]}),(null==l?void 0:l.fileUrl)&&(0,s.jsx)(n.$,{onClick:x,disabled:u||c,className:"w-full",size:"sm",children:u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"}),"下载中..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.A,{className:"h-3.5 w-3.5 mr-1.5"}),"下载 PDF"]})})]})}),(0,s.jsx)("div",{className:"flex-1 flex flex-col min-w-0",children:(0,s.jsx)("div",{className:"flex-1 bg-background overflow-hidden",children:i?(0,s.jsx)(U,{fileUrl:i,fileName:(null==l?void 0:l.archiveNo)?"".concat(l.archiveNo,".pdf"):"档案.pdf",downloadAllowed:!1,height:"100%",showToolbar:!1}):c?(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(m.A,{className:"h-8 w-8 animate-spin text-blue-500"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"正在加载..."})]})}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4 max-w-md",children:[(0,s.jsx)(y.A,{className:"h-16 w-16 mx-auto text-muted-foreground"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"该档案没有关联的 PDF 文件"})]})})})})]})})})}var R=a(3950);let q="确认删除";function J(e){let{open:t,onOpenChange:a,onConfirm:l,title:d,description:c,itemName:o,isBatch:u=!1,itemCount:h=1}=e,[x,p]=(0,r.useState)(""),[f,g]=(0,r.useState)(!1),[j,N]=(0,r.useState)(""),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{t&&(p(""),g(!1),N(""),setTimeout(()=>{var e;null===(e=b.current)||void 0===e||e.focus()},100))},[t]);let y=x.trim()===q,w=async()=>{if(y){g(!0),N("");try{let e=await l();e.success?a(!1):(N(e.error||"删除失败，请重试"),g(!1))}catch(e){console.error("Delete error:",e),N(e instanceof Error?e.message:"删除失败，请重试"),g(!1)}}},S=()=>u?"批量删除 ".concat(h," 个档案"):"删除档案",k=()=>u?"您即将删除 ".concat(h," 个档案。删除后数据将无法恢复，请谨慎操作。"):o?'您即将删除档案"'.concat(o,'"。删除后数据将无法恢复，请谨慎操作。'):"您即将删除此档案。删除后数据将无法恢复，请谨慎操作。";return(0,s.jsx)(D.lG,{open:t,onOpenChange:e=>{e&&f||a(e)},children:(0,s.jsxs)(D.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(D.c7,{children:[(0,s.jsxs)(D.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)(R.A,{className:"h-5 w-5 text-destructive"}),d||S()]}),(0,s.jsx)(D.rr,{children:c||k()})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)(v.Fc,{variant:"destructive",children:[(0,s.jsx)(R.A,{className:"h-4 w-4"}),(0,s.jsx)(v.TN,{children:"警告：此操作不可撤销！删除后的档案数据将永久丢失。"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{htmlFor:"confirm-input",className:"text-sm font-medium",children:["为了确认删除操作，请输入 ",(0,s.jsxs)("span",{className:"font-bold",children:['"',q,'"']})]}),(0,s.jsx)(i.p,{ref:b,id:"confirm-input",value:x,onChange:e=>{p(e.target.value),j&&N("")},placeholder:"请输入: ".concat(q),disabled:f,onKeyDown:e=>{"Enter"===e.key&&y&&!f&&w()},className:y?"border-green-500 focus-visible:ring-green-500":""}),!y&&x.length>0&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:"请输入正确的确认文本"}),j&&(0,s.jsx)("p",{className:"text-xs text-destructive font-medium",children:j})]})]}),(0,s.jsxs)(D.Es,{children:[(0,s.jsx)(n.$,{variant:"outline",onClick:()=>a(!1),disabled:f,children:"取消"}),(0,s.jsx)(n.$,{variant:"destructive",onClick:w,disabled:!y||f,children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2 animate-spin"}),"删除中..."]}):"确认删除"})]})]})})}var O=a(1621),$=a(9602),T=a(698),G=a(3518),B=a(6967),Y=a(1719),V=a(1544),Z=a(8105);function H(){let e=(0,T._)(["rtl:**:[.rdp-button_next>svg]:rotate-180"],["rtl:**:[.rdp-button\\_next>svg]:rotate-180"]);return H=function(){return e},e}function X(){let e=(0,T._)(["rtl:**:[.rdp-button_previous>svg]:rotate-180"],["rtl:**:[.rdp-button\\_previous>svg]:rotate-180"]);return X=function(){return e},e}function K(e){let{className:t,classNames:a,showOutsideDays:r=!0,captionLayout:l="label",buttonVariant:i="ghost",formatters:d,components:c,...o}=e,u=(0,V.a)();return(0,s.jsx)(Z.h,{showOutsideDays:r,className:(0,$.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw(H()),String.raw(X()),t),captionLayout:l,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...d},classNames:{root:(0,$.cn)("w-fit",u.root),months:(0,$.cn)("flex gap-4 flex-col md:flex-row relative",u.months),month:(0,$.cn)("flex flex-col w-full gap-4",u.month),nav:(0,$.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",u.nav),button_previous:(0,$.cn)((0,n.r)({variant:i}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",u.button_previous),button_next:(0,$.cn)((0,n.r)({variant:i}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",u.button_next),month_caption:(0,$.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",u.month_caption),dropdowns:(0,$.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",u.dropdowns),dropdown_root:(0,$.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",u.dropdown_root),dropdown:(0,$.cn)("absolute bg-popover inset-0 opacity-0",u.dropdown),caption_label:(0,$.cn)("select-none font-medium","label"===l?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",u.caption_label),table:"w-full border-collapse",weekdays:(0,$.cn)("flex",u.weekdays),weekday:(0,$.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",u.weekday),week:(0,$.cn)("flex w-full mt-2",u.week),week_number_header:(0,$.cn)("select-none w-(--cell-size)",u.week_number_header),week_number:(0,$.cn)("text-[0.8rem] select-none text-muted-foreground",u.week_number),day:(0,$.cn)("relative w-full h-full p-0 text-center [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",o.showWeekNumber?"[&:nth-child(2)[data-selected=true]_button]:rounded-l-md":"[&:first-child[data-selected=true]_button]:rounded-l-md",u.day),range_start:(0,$.cn)("rounded-l-md bg-accent",u.range_start),range_middle:(0,$.cn)("rounded-none",u.range_middle),range_end:(0,$.cn)("rounded-r-md bg-accent",u.range_end),today:(0,$.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",u.today),outside:(0,$.cn)("text-muted-foreground aria-selected:text-muted-foreground",u.outside),disabled:(0,$.cn)("text-muted-foreground opacity-50",u.disabled),hidden:(0,$.cn)("invisible",u.hidden),...a},components:{Root:e=>{let{className:t,rootRef:a,...r}=e;return(0,s.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,$.cn)(t),...r})},Chevron:e=>{let{className:t,orientation:a,...r}=e;return"left"===a?(0,s.jsx)(G.A,{className:(0,$.cn)("size-4",t),...r}):"right"===a?(0,s.jsx)(B.A,{className:(0,$.cn)("size-4",t),...r}):(0,s.jsx)(Y.A,{className:(0,$.cn)("size-4",t),...r})},DayButton:Q,WeekNumber:e=>{let{children:t,...a}=e;return(0,s.jsx)("td",{...a,children:(0,s.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:t})})},...c},...o})}function Q(e){let{className:t,day:a,modifiers:l,...i}=e,d=(0,V.a)(),c=r.useRef(null);return r.useEffect(()=>{var e;l.focused&&(null===(e=c.current)||void 0===e||e.focus())},[l.focused]),(0,s.jsx)(n.$,{ref:c,variant:"ghost",size:"icon","data-day":a.date.toLocaleDateString(),"data-selected-single":l.selected&&!l.range_start&&!l.range_end&&!l.range_middle,"data-range-start":l.range_start,"data-range-end":l.range_end,"data-range-middle":l.range_middle,className:(0,$.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",d.day,t),...i})}var ee=a(2945);let et=ee.bL,ea=ee.l9,es=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:l=4,...n}=e;return(0,s.jsx)(ee.ZL,{children:(0,s.jsx)(ee.UC,{ref:t,align:r,sideOffset:l,className:(0,$.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});function er(e){let{className:t,value:a,onChange:l}=e,[i,d]=r.useState(()=>{if((null==a?void 0:a.from)||(null==a?void 0:a.to))return{from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0}});return r.useEffect(()=>{if(!(null==a?void 0:a.from)&&!(null==a?void 0:a.to)){d(void 0);return}d({from:a.from?new Date(a.from):void 0,to:a.to?new Date(a.to):void 0})},[a]),(0,s.jsx)("div",{className:(0,$.cn)("grid gap-2",t),children:(0,s.jsxs)(et,{children:[(0,s.jsx)(ea,{asChild:!0,children:(0,s.jsxs)(n.$,{id:"date",variant:"outline",className:(0,$.cn)("justify-start text-left font-normal",!i&&"text-muted-foreground"),children:[(0,s.jsx)(W.A,{className:"mr-2 h-4 w-4"}),(null==i?void 0:i.from)?i.to?(0,s.jsxs)(s.Fragment,{children:[(0,O.GP)(i.from,"yyyy-MM-dd")," -"," ",(0,O.GP)(i.to,"yyyy-MM-dd")]}):(0,O.GP)(i.from,"yyyy-MM-dd"):(0,s.jsx)("span",{children:"选择日期范围"})]})}),(0,s.jsx)(es,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(K,{initialFocus:!0,mode:"range",defaultMonth:null==i?void 0:i.from,selected:i,onSelect:e=>{d(e),(null==e?void 0:e.from)?l({from:(0,O.GP)(e.from,"yyyy-MM-dd"),to:e.to?(0,O.GP)(e.to,"yyyy-MM-dd"):void 0}):l({from:void 0,to:void 0})},numberOfMonths:2})})]})})}es.displayName=ee.UC.displayName;var el=a(7364);function en(e){let{query:t,total:a,category:r,tags:i}=e,d=(0,l.useRouter)(),c=()=>{d.push("/search")};return(0,s.jsx)("div",{className:"bg-blue-50 border-b border-blue-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["搜索结果：",(0,s.jsxs)("span",{className:"text-blue-600",children:['"',t,'"']})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["找到 ",a," 个相关档案"]}),(r||i&&i.length>0)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"•"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"筛选："}),r&&(0,s.jsxs)(p.E,{variant:"secondary",className:"text-xs",children:["分类: ",r]}),i&&i.map(e=>(0,s.jsx)(p.E,{variant:"secondary",className:"text-xs",children:e},e))]})]})]})]}),(0,s.jsxs)(n.$,{variant:"outline",onClick:c,className:"flex items-center gap-2",children:[(0,s.jsx)(el.A,{className:"h-4 w-4"}),"返回搜索页"]})]})})})}var ei=a(1453),ed=a(5828);let ec=(0,ed.createServerReference)("00682b0a390774c17f6346c371808fdff26f013bcb",ed.callServer,void 0,ed.findSourceMapURL,"getArchiveFiltersAction"),eo=(0,ed.createServerReference)("40eca59309a8b7c4f8d6789479868cb4fa04d46d53",ed.callServer,void 0,ed.findSourceMapURL,"queryArchivesAction"),eu=(0,ed.createServerReference)("404df0eb25ce47a1e756a01d5cf2fba9eacb24ed5b",ed.callServer,void 0,ed.findSourceMapURL,"deleteArchiveAction"),eh=(0,ed.createServerReference)("409504788099a5bcdf314525479bc08d204705fc8c",ed.callServer,void 0,ed.findSourceMapURL,"batchDeleteArchivesAction");var ex=a(821);let em=["永久","长期","短期","10年","30年"];function ev(){var e;(0,l.useRouter)();let t=(0,l.useSearchParams)(),{setLoading:a}=(0,ex.M)(),p="true"===t.get("fromSearch"),f=t.get("q")||"",g=t.get("category")||void 0,j=(null===(e=t.get("tags"))||void 0===e?void 0:e.split(",").filter(Boolean))||void 0,[N,b]=(0,r.useState)([]),[y,w]=(0,r.useState)(0),[S,k]=(0,r.useState)(0),[C,A]=(0,r.useState)(!1),[z,D]=(0,r.useState)(""),[E,W]=(0,r.useState)(1),[L]=(0,r.useState)(20),[M,P]=(0,r.useState)([]),[U,R]=(0,r.useState)(""),[q,O]=(0,r.useState)(""),[$,T]=(0,r.useState)(""),[G,B]=(0,r.useState)(""),Y=p&&f?f:"",[V,Z]=(0,r.useState)(Y),[H,X]=(0,r.useState)("all"),[K,Q]=(0,r.useState)("all"),[ee,et]=(0,r.useState)(""),[ea,es]=(0,r.useState)({}),[el,ed]=(0,r.useState)(),[ev,ep]=(0,r.useState)(),[ef,eg]=(0,r.useState)({years:[],responsibles:[]}),[ej,eN]=(0,r.useState)(!1),[eb,ey]=(0,r.useState)(!1),[ew,eS]=(0,r.useState)(!1),[ek,eC]=(0,r.useState)(!1),[eA,ez]=(0,r.useState)(null),[eF,e_]=(0,r.useState)([]),[eD,eE]=(0,r.useState)(0),eW=p&&!!f,[eL,eM]=(0,r.useState)(!1);(0,r.useEffect)(()=>{eL||(console.log("[Archives] useEffect - Initial state",{fromSearch:p,searchQuery:f,search:V,useSearchMode:eW}),eP(),p&&f&&(console.log("[Archives] Init from search page",{searchQuery:f,initialSearchCategory:g,initialSearchTags:j}),g&&ed(g),j&&ep(j)),setTimeout(()=>{eE(1),eM(!0)},0))},[]),(0,r.useEffect)(()=>{console.log("[Archives] Loading archives triggered by queryTrigger:",eD),eU()},[eD]),(0,r.useEffect)(()=>{console.log("[Archives] Loading archives triggered by page change:",E),eD>0&&eU()},[E,eD]);let eP=async()=>{try{let e=await ec();if(e.success&&e.data){let t=e.data;eg({years:(t.years||[]).filter(e=>e&&""!==e.trim()),responsibles:[]})}}catch(e){console.error("Failed to load filter options:",e)}},eU=async()=>{console.log("[Archives] loadArchives called, current loading:",C),A(!0),D(""),P([]);try{if(eW&&V){console.log("[Archives] Using Meilisearch mode",{search:V,searchCategory:el,searchTags:ev,page:E});let e=new URLSearchParams({q:V,page:E.toString(),limit:L.toString()});el&&e.set("category",el),ev&&ev.length>0&&e.set("tags",ev.join(",")),console.log("[Archives] Fetching from Meilisearch:",e.toString());let t=await fetch("/api/search?".concat(e.toString()));if(!t.ok)throw Error("搜索失败");let a=await t.json();console.log("[Archives] Meilisearch response:",a.pagination.total,"results");let s=a.results;b(s),w(a.pagination.total),k(Math.ceil(a.pagination.total/L))}else{console.log("[Archives] Using PostgreSQL mode",{search:V,archiveNo:U,fondsNo:q,boxNo:$,pieceNo:G,year:H,retentionPeriod:K,responsible:ee,dateRange:ea,page:E});let e=await eo({page:E,pageSize:L,search:V||void 0,archiveNo:U||void 0,fondsNo:q||void 0,boxNo:$||void 0,pieceNo:G||void 0,year:"all"!==H?H:void 0,retentionPeriod:"all"!==K?K:void 0,responsible:ee||void 0,dateStart:ea.from,dateEnd:ea.to});if(e.success&&e.data){let t=e.data;b(t.items),w(t.total),k(t.totalPages)}else D(e.error||"加载档案失败")}}catch(e){console.error("Failed to load archives:",e),D("加载档案失败，请重试")}finally{A(!1)}},eI=()=>{W(1),eE(e=>e+1)},eR=()=>{Z(""),R(""),O(""),T(""),B(""),X("all"),Q("all"),et(""),es({}),W(1),ed(void 0),ep([]),eE(e=>e+1)},eq=e=>{ez(e),ey(!0)},eJ=async e=>{ez(N.find(t=>t.archiveID===e)||null),e_([e]),eC(!0)},eO=async e=>{e_(e),eC(!0)},e$=async()=>{a(!0,eF.length>1?"正在批量删除...":"正在删除...");try{let e;if((e=1===eF.length?await eu(eF[0]):await eh(eF)).success)return await eU(),{success:!0};return{success:!1,error:e.error||"删除失败"}}catch(e){return console.error("Failed to delete archive:",e),{success:!1,error:e instanceof Error?e.message:"删除失败，请重试"}}finally{a(!1)}},eT=e=>{ez(e),eS(!0)},eG=()=>{eN(!1),ey(!1),ez(null),eU(),eP()},eB=V||U||q||$||G||"all"!==H||"all"!==K||ee||ea.from||ea.to;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"档案管理"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["共 ",y," 个档案"]})]})}),eW&&V&&(0,s.jsx)(en,{query:V,total:y,category:el,tags:ev}),z&&(0,s.jsxs)(v.Fc,{variant:"destructive",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)(v.TN,{children:z})]}),!eW&&(0,s.jsx)(d.Zp,{children:(0,s.jsx)(d.Wu,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(h.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)(i.p,{placeholder:"查询题名...",value:V,onChange:e=>Z(e.target.value),onKeyDown:e=>{"Enter"===e.key&&eI()},className:"pl-10"})]}),(0,s.jsx)(n.$,{onClick:eI,children:"查询"}),(0,s.jsxs)(n.$,{variant:"outline",onClick:eR,disabled:!eB,children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"重置"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"archiveNo",children:"档号"}),(0,s.jsx)(i.p,{id:"archiveNo",placeholder:"精确匹配档号",value:U,onChange:e=>R(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"fondsNo",children:"全宗号"}),(0,s.jsx)(i.p,{id:"fondsNo",placeholder:"精确匹配全宗号",value:q,onChange:e=>O(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"boxNo",children:"盒号"}),(0,s.jsx)(i.p,{id:"boxNo",placeholder:"精确匹配盒号",value:$,onChange:e=>T(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"pieceNo",children:"件号"}),(0,s.jsx)(i.p,{id:"pieceNo",placeholder:"精确匹配件号",value:G,onChange:e=>B(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"year",children:"年度"}),(0,s.jsxs)(c.l6,{value:H,onValueChange:X,children:[(0,s.jsx)(c.bq,{id:"year",children:(0,s.jsx)(c.yv,{placeholder:"全部年度"})}),(0,s.jsxs)(c.gC,{children:[(0,s.jsx)(c.eb,{value:"all",children:"全部年度"}),ef.years.map(e=>(0,s.jsx)(c.eb,{value:e,children:e},e))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"retentionPeriod",children:"保管期限"}),(0,s.jsxs)(c.l6,{value:K,onValueChange:Q,children:[(0,s.jsx)(c.bq,{id:"retentionPeriod",children:(0,s.jsx)(c.yv,{placeholder:"全部期限"})}),(0,s.jsxs)(c.gC,{children:[(0,s.jsx)(c.eb,{value:"all",children:"全部期限"}),em.map(e=>(0,s.jsx)(c.eb,{value:e,children:e},e))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{htmlFor:"responsible",children:"责任者"}),(0,s.jsx)(i.p,{id:"responsible",placeholder:"责任者关键词",value:ee,onChange:e=>et(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.J,{children:"日期范围"}),(0,s.jsx)(er,{value:ea,onChange:es})]})]})]})})}),eW&&(0,s.jsx)(d.Zp,{className:"border-blue-200 bg-blue-50",children:(0,s.jsx)(d.Wu,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-1",children:"当前使用全文搜索模式"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"您正在使用 Meilisearch 全文搜索引擎查看结果。"}),(el||ev&&ev.length>0)&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"当前筛选："}),el&&(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-700",children:["分类: ",el]}),ev&&ev.map(e=>(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-700",children:e},e))]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)(n.$,{variant:"outline",size:"sm",onClick:eR,children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"切换到筛选模式"]})})]})]})})}),C?(0,s.jsx)(d.Zp,{children:(0,s.jsx)(d.Wu,{className:"py-12",children:(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)(m.A,{className:"h-8 w-8 animate-spin mx-auto text-blue-500"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"加载中..."})]})})})}):(0,s.jsx)(F,{archives:N,selectedIds:M,onSelectionChange:P,onView:eT,onEdit:eq,onDelete:eJ,onBatchDelete:eO,onDownload:()=>{}}),S>1&&(0,s.jsx)(d.Zp,{children:(0,s.jsx)(d.Wu,{className:"pt-6",children:(0,s.jsx)(ei.d,{currentPage:E,totalPages:S,total:y,pageSize:L,onPageChange:W})})}),(0,s.jsx)(_.b,{open:ej,onOpenChange:eN,onSuccess:eG}),(0,s.jsx)(_.b,{open:eb,onOpenChange:ey,onSuccess:eG,archive:eA}),(0,s.jsx)(I,{open:ew,onOpenChange:eS,archive:eA}),(0,s.jsx)(J,{open:ek,onOpenChange:eC,onConfirm:e$,itemName:null==eA?void 0:eA.title,isBatch:eF.length>1,itemCount:eF.length})]})}},789:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{b:()=>ArchiveFormDialog});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5155),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2115),_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7837),_components_ui_button__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4085),_components_ui_input__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2336),_components_ui_label__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5785),_components_ui_select__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(745),_components_ui_textarea__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(371),_app_archive_archives_actions__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(8294),_app_archive_archives_actions__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5812),_barrel_optimize_names_FileText_Loader2_lucide_react__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(4081),_barrel_optimize_names_FileText_Loader2_lucide_react__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(4505);let RETENTION_PERIODS=[{label:"永久",value:"永久",code:"Y"},{label:"长期",value:"长期",code:"C"},{label:"短期",value:"短期",code:"D"},{label:"10年",value:"10年",code:"10"},{label:"30年",value:"30年",code:"30"}];function ArchiveFormDialog(param){let{open,onOpenChange,onSuccess,archive}=param,isEditing=!!archive,[archiveNo,setArchiveNo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.archiveNo)||""),[fondsNo,setFondsNo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.fondsNo)||""),[retentionPeriod,setRetentionPeriod]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.retentionPeriod)||""),[retentionCode,setRetentionCode]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.retentionCode)||""),[year,setYear]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.year)||""),[deptCode,setDeptCode]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.deptCode)||""),[boxNo,setBoxNo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.boxNo)||""),[pieceNo,setPieceNo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.pieceNo)||""),[title,setTitle]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.title)||""),[deptIssue,setDeptIssue]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.deptIssue)||""),[responsible,setResponsible]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.responsible)||""),[docNo,setDocNo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.docNo)||""),[date,setDate]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.date)||""),[pageNo,setPageNo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.pageNo)||""),[remark,setRemark]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.remark)||""),[fileUrl,setFileUrl]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)((null==archive?void 0:archive.fileUrl)||""),[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)("");(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{open&&(archive?(setArchiveNo(archive.archiveNo),setFondsNo(archive.fondsNo),setRetentionPeriod(archive.retentionPeriod),setRetentionCode(archive.retentionCode),setYear(archive.year),setDeptCode(archive.deptCode),setBoxNo(archive.boxNo),setPieceNo(archive.pieceNo),setTitle(archive.title),setDeptIssue(archive.deptIssue),setResponsible(archive.responsible),setDocNo(archive.docNo),setDate(archive.date),setPageNo(archive.pageNo),setRemark(archive.remark||""),setFileUrl(archive.fileUrl||"")):(setArchiveNo(""),setFondsNo(""),setRetentionPeriod(""),setRetentionCode(""),setYear(""),setDeptCode(""),setBoxNo(""),setPieceNo(""),setTitle(""),setDeptIssue(""),setResponsible(""),setDocNo(""),setDate(""),setPageNo(""),setRemark(""),setFileUrl("")),setError(""))},[open,archive]);let handleRetentionPeriodChange=e=>{setRetentionPeriod(e);let t=RETENTION_PERIODS.find(t=>t.value===e);t&&setRetentionCode(t.code)},handleSubmit=async e=>{e.preventDefault();let requiredFields={archiveNo:"档号",fondsNo:"全宗号",retentionPeriod:"保管期限",retentionCode:"保管期限代码",year:"年度",deptCode:"机构问题代码",boxNo:"盒号",pieceNo:"件号",title:"题名",deptIssue:"机构问题",responsible:"责任者",docNo:"文号",date:"日期",pageNo:"页号"};for(let[field,label]of Object.entries(requiredFields)){let value=eval(field);if(!value||""===value.toString().trim()){setError("".concat(label,"不能为空"));return}}if(archiveNo.length>100){setError("档号不能超过100个字符");return}if(title.length>200){setError("题名不能超过200个字符");return}if(date&&!/^\d{4}[-/]\d{1,2}[-/]\d{1,2}$/.test(date)){setError("日期格式应为 YYYY-MM-DD");return}setLoading(!0),setError("");try{if(isEditing&&archive){let updateData={archiveNo,fondsNo,retentionPeriod,retentionCode,year,deptCode,boxNo,pieceNo,title,deptIssue,responsible,docNo,date,pageNo,remark:remark||void 0,fileUrl:fileUrl||void 0},result=await (0,_app_archive_archives_actions__WEBPACK_IMPORTED_MODULE_8__._)(archive.archiveID,updateData);result.success?(onSuccess(),onOpenChange(!1)):setError(result.error||"更新失败")}else{let createData={archiveNo,fondsNo,retentionPeriod,retentionCode,year,deptCode,boxNo,pieceNo,title,deptIssue,responsible,docNo,date,pageNo,remark:remark||void 0,fileUrl:fileUrl||void 0},result=await (0,_app_archive_archives_actions__WEBPACK_IMPORTED_MODULE_9__.T)(createData);result.success?(onSuccess(),onOpenChange(!1)):setError(result.error||"创建失败")}}catch(err){console.error("Failed to save archive:",err),setError("操作失败，请重试")}finally{setLoading(!1)}};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__.lG,{open:open,onOpenChange:onOpenChange,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__.Cf,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__.c7,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__.L3,{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_FileText_Loader2_lucide_react__WEBPACK_IMPORTED_MODULE_10__.A,{className:"h-5 w-5"}),isEditing?"编辑档案":"新增档案"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__.rr,{children:isEditing?"修改档案信息":"填写档案信息"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("form",{onSubmit:handleSubmit,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"archiveNo",children:["档号 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"archiveNo",value:archiveNo,onChange:e=>setArchiveNo(e.target.value),placeholder:"例如: 2024-001-001-001",disabled:isEditing,required:!0}),!isEditing&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-xs text-muted-foreground",children:"档号创建后不可修改"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"fondsNo",children:["全宗号 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"fondsNo",value:fondsNo,onChange:e=>setFondsNo(e.target.value),placeholder:"例如: 001",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"year",children:["年度 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"year",value:year,onChange:e=>setYear(e.target.value),placeholder:"例如: 2024",required:!0})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"retentionPeriod",children:["保管期限 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_select__WEBPACK_IMPORTED_MODULE_6__.l6,{value:retentionPeriod||void 0,onValueChange:handleRetentionPeriodChange,required:!0,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_select__WEBPACK_IMPORTED_MODULE_6__.bq,{id:"retentionPeriod",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_select__WEBPACK_IMPORTED_MODULE_6__.yv,{placeholder:"选择保管期限"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_select__WEBPACK_IMPORTED_MODULE_6__.gC,{children:RETENTION_PERIODS.map(e=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_select__WEBPACK_IMPORTED_MODULE_6__.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"retentionCode",children:["保管期限代码 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"retentionCode",value:retentionCode,onChange:e=>setRetentionCode(e.target.value),placeholder:"例如: Y",required:!0,readOnly:!0,className:"bg-muted"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"deptCode",children:["机构问题代码 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"deptCode",value:deptCode,onChange:e=>setDeptCode(e.target.value),placeholder:"例如: 001",required:!0})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"boxNo",children:["盒号 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"boxNo",value:boxNo,onChange:e=>setBoxNo(e.target.value),placeholder:"例如: 001",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"pieceNo",children:["件号 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"pieceNo",value:pieceNo,onChange:e=>setPieceNo(e.target.value),placeholder:"例如: 001",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"docNo",children:["文号 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"docNo",value:docNo,onChange:e=>setDocNo(e.target.value),placeholder:"例如: [2024] 1号",required:!0})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"title",children:["题名 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"title",value:title,onChange:e=>setTitle(e.target.value),placeholder:"档案题名",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"deptIssue",children:["机构问题 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"deptIssue",value:deptIssue,onChange:e=>setDeptIssue(e.target.value),placeholder:"例如: 办公室",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"responsible",children:["责任者 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"responsible",value:responsible,onChange:e=>setResponsible(e.target.value),placeholder:"例如: 张三",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"date",children:["日期 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"date",type:"date",value:date,onChange:e=>setDate(e.target.value),required:!0})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"pageNo",children:["页号 ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"pageNo",value:pageNo,onChange:e=>setPageNo(e.target.value),placeholder:"例如: 1-10",required:!0})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"fileUrl",children:"PDF文件URL"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_input__WEBPACK_IMPORTED_MODULE_4__.p,{id:"fileUrl",value:fileUrl,onChange:e=>setFileUrl(e.target.value),placeholder:"https://example.com/file.pdf",type:"url"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-xs text-muted-foreground",children:"可选，用于PDF预览和下载"})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_label__WEBPACK_IMPORTED_MODULE_5__.J,{htmlFor:"remark",children:"备注"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_textarea__WEBPACK_IMPORTED_MODULE_7__.T,{id:"remark",value:remark,onChange:e=>setRemark(e.target.value),placeholder:"备注信息（可选）",rows:3})]}),error&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"rounded-md bg-destructive/10 p-3",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-sm text-destructive",children:error})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_components_ui_dialog__WEBPACK_IMPORTED_MODULE_2__.Es,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_button__WEBPACK_IMPORTED_MODULE_3__.$,{type:"button",variant:"outline",onClick:()=>onOpenChange(!1),disabled:loading,children:"取消"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_ui_button__WEBPACK_IMPORTED_MODULE_3__.$,{type:"submit",disabled:loading,children:loading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_barrel_optimize_names_FileText_Loader2_lucide_react__WEBPACK_IMPORTED_MODULE_11__.A,{className:"h-4 w-4 mr-2 animate-spin"}),"保存中..."]}):isEditing?"保存":"创建"})]})]})]})})}},3670:(e,t,a)=>{"use strict";a.d(t,{S:()=>i});var s=a(5155);a(2115);var r=a(6352),l=a(8867),n=a(9602);function i(e){let{className:t,...a}=e;return(0,s.jsx)(r.bL,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:(0,s.jsx)(l.A,{className:"size-3.5"})})})}},1453:(e,t,a)=>{"use strict";a.d(t,{d:()=>o});var s=a(5155),r=a(4085),l=a(2336),n=a(7661),i=a(3518),d=a(6967),c=a(7054);function o(e){let{currentPage:t,totalPages:a,total:o,pageSize:u,onPageChange:h}=e,x=(t-1)*u+1,m=Math.min(t*u,o),v=e=>{e>=1&&e<=a&&h(e)};return o<=u?null:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex-1",children:["显示 ",x," - ",m," / 共 ",o," 条"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.$,{size:"sm",variant:"outline",disabled:1===t,onClick:()=>v(1),title:"首页",children:(0,s.jsx)(n.A,{className:"h-4 w-4"})}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",disabled:1===t,onClick:()=>v(t-1),title:"上一页",children:(0,s.jsx)(i.A,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("span",{className:"text-sm",children:["第",(0,s.jsx)(l.p,{type:"number",min:1,max:a,value:t,onChange:e=>{let t=parseInt(e.target.value);t>=1&&t<=a&&h(t)},className:"w-16 h-8 text-center"}),"/ ",a," 页"]})}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",disabled:t===a,onClick:()=>v(t+1),title:"下一页",children:(0,s.jsx)(d.A,{className:"h-4 w-4"})}),(0,s.jsx)(r.$,{size:"sm",variant:"outline",disabled:t===a,onClick:()=>v(a),title:"尾页",children:(0,s.jsx)(c.A,{className:"h-4 w-4"})})]})]})}},371:(e,t,a)=>{"use strict";a.d(t,{T:()=>l});var s=a(5155);a(2115);var r=a(9602);function l(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}},821:(e,t,a)=>{"use strict";a.d(t,{M:()=>i,o:()=>n});var s=a(5155),r=a(2115);let l=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,r.useState)(!1),[i,d]=(0,r.useState)("处理中..."),c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"处理中...";n(e),d(t)};return(0,s.jsx)(l.Provider,{value:{isLoading:a,message:i,setLoading:c},children:t})}function i(){let e=(0,r.useContext)(l);if(!e)throw Error("useLoading must be used within LoadingProvider");return e}},247:(e,t,a)=>{"use strict";a.d(t,{L:()=>r});var s=a(5828);let r=(0,s.createServerReference)("4001573c496718f012e748331750816f84abe9b4fc",s.callServer,void 0,s.findSourceMapURL,"logArchiveDownloadAction")},5812:(e,t,a)=>{"use strict";a.d(t,{T:()=>r});var s=a(5828);let r=(0,s.createServerReference)("40a24d8f262e8c7e49a787ed89dc74dfdb25dd2949",s.callServer,void 0,s.findSourceMapURL,"createArchiveAction")},8294:(e,t,a)=>{"use strict";a.d(t,{_:()=>r});var s=a(5828);let r=(0,s.createServerReference)("60346e8ae46836d35b0e108eb1104d1ad9953f197b",s.callServer,void 0,s.findSourceMapURL,"updateArchiveAction")}},e=>{var t=t=>e(e.s=t);e.O(0,[9406,2291,8348,7294,985,650,8441,1517,7358],()=>t(165)),_N_E=e.O()}]);