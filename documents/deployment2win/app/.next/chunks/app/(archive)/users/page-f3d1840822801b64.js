(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3603],{6428:(e,s,a)=>{Promise.resolve().then(a.bind(a,9409))},9409:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>I});var t=a(5155),r=a(2115),n=a(696),l=a(4085),d=a(2336),i=a(3670),c=a(2079),o=a(5007),u=a(9677),x=a(745),h=a(7144),m=a(6967),j=a(8867),p=a(3565),f=a(9602);let v=h.bL,g=h.l9;h.YJ,h.ZL,h.Pb,h.z6,r.forwardRef((e,s)=>{let{className:a,inset:r,children:n,...l}=e;return(0,t.jsxs)(h.ZP,{ref:s,className:(0,f.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...l,children:[n,(0,t.jsx)(m.A,{className:"ml-auto"})]})}).displayName=h.ZP.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(h.G5,{ref:s,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=h.G5.displayName;let b=r.forwardRef((e,s)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,t.jsx)(h.ZL,{children:(0,t.jsx)(h.UC,{ref:s,sideOffset:r,className:(0,f.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});b.displayName=h.UC.displayName;let N=r.forwardRef((e,s)=>{let{className:a,inset:r,...n}=e;return(0,t.jsx)(h.q7,{ref:s,className:(0,f.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n})});N.displayName=h.q7.displayName,r.forwardRef((e,s)=>{let{className:a,children:r,checked:n,...l}=e;return(0,t.jsxs)(h.H_,{ref:s,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...l,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(h.VF,{children:(0,t.jsx)(j.A,{className:"h-4 w-4"})})}),r]})}).displayName=h.H_.displayName,r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsxs)(h.hN,{ref:s,className:(0,f.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(h.VF,{children:(0,t.jsx)(p.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=h.hN.displayName,r.forwardRef((e,s)=>{let{className:a,inset:r,...n}=e;return(0,t.jsx)(h.JU,{ref:s,className:(0,f.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})}).displayName=h.JU.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(h.wv,{ref:s,className:(0,f.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=h.wv.displayName;var y=a(6046),w=a(7837),S=a(5785),C=a(4505),k=a(5828);let A=(0,k.createServerReference)("40e26eddb0a2537ac1e6816ee237a2762046a837a8",k.callServer,void 0,k.findSourceMapURL,"createUser"),R=(0,k.createServerReference)("60b68aa7ab366013c57ae5e5e44a1ce117c4d3dd9b",k.callServer,void 0,k.findSourceMapURL,"updateUser");var z=a(814);function F(e){let{open:s,onOpenChange:a,mode:n,initialData:i,onSuccess:c}=e,o=(0,y.useRouter)(),[h,m]=(0,r.useState)(""),[j,p]=(0,r.useState)(""),[f,v]=(0,r.useState)(""),[g,b]=(0,r.useState)("user"),[N,k]=(0,r.useState)("enabled"),[F,L]=(0,r.useState)(!1),[_,P]=(0,r.useState)(""),[U,$]=(0,r.useState)(""),[M,Z]=(0,r.useState)("");(0,r.useEffect)(()=>{s&&("edit"===n&&i?(m(i.username),b(i.role),k(i.status),p(""),v("")):(m(""),p(""),v(""),b("user"),k("enabled")),P(""),$(""),Z(""))},[s,n,i]);let E=e=>e?e.length<3?($("用户名至少 3 位"),!1):e.length>50?($("用户名最多 50 位"),!1):/^[a-zA-Z0-9_]+$/.test(e)?($(""),!0):($("用户名只能包含字母、数字和下划线"),!1):($("用户名不能为空"),!1),J=e=>"create"!==n||e?e&&e.length<8?(Z("密码至少 8 位"),!1):e&&!/^(?=.*[A-Za-z])(?=.*\d)/.test(e)?(Z("密码必须包含字母和数字"),!1):(Z(""),!0):(Z("密码不能为空"),!1),O=async()=>{if(P(""),E(h)){if("create"===n){if(!J(j))return;if(j!==f){Z("两次密码不一致");return}}L(!0);try{"create"===n?(await A({username:h,password:j,role:g}),z.o.success("用户创建成功")):i&&(await R(i.id,{role:g,status:N}),z.o.success("用户更新成功")),null==c||c(),a(!1),o.refresh()}catch(e){P(e.message||"操作失败，请重试")}finally{L(!1)}}};return(0,t.jsx)(w.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(w.Cf,{className:"sm:max-w-[425px]",children:[(0,t.jsxs)(w.c7,{children:[(0,t.jsx)(w.L3,{children:"create"===n?"新增用户":"编辑用户"}),(0,t.jsx)(w.rr,{children:"create"===n?"创建新用户账户":"修改用户角色和状态（用户名不可修改）"})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[_&&(0,t.jsx)(u.Fc,{variant:"destructive",children:(0,t.jsx)(u.TN,{children:_})}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"username",children:["用户名 ","edit"===n&&"(不可修改)"]}),(0,t.jsx)(d.p,{id:"username",value:h,onChange:e=>{let s=e.target.value;m(s),"create"===n&&E(s)},disabled:"edit"===n||F,placeholder:"输入用户名",className:U?"border-red-500":""}),U&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:U})]}),"create"===n&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"password",children:["密码 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(d.p,{id:"password",type:"password",value:j,onChange:e=>{let s=e.target.value;p(s),J(s)},disabled:F,placeholder:"输入密码（至少 8 位，包含字母和数字）",className:M?"border-red-500":""}),M&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:M})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"confirmPassword",children:["确认密码 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(d.p,{id:"confirmPassword",type:"password",value:f,onChange:e=>v(e.target.value),disabled:F,placeholder:"再次输入密码",className:j!==f&&f?"border-red-500":""}),j!==f&&f&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:"两次密码不一致"})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"role",children:["角色 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(x.l6,{value:g,onValueChange:e=>b(e),disabled:F,children:[(0,t.jsx)(x.bq,{id:"role",children:(0,t.jsx)(x.yv,{placeholder:"选择角色"})}),(0,t.jsxs)(x.gC,{children:[(0,t.jsx)(x.eb,{value:"user",children:"普通用户"}),(0,t.jsx)(x.eb,{value:"admin",children:"管理员"})]})]})]}),"edit"===n&&(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"status",children:["状态 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(x.l6,{value:N,onValueChange:e=>k(e),disabled:F,children:[(0,t.jsx)(x.bq,{id:"status",children:(0,t.jsx)(x.yv,{placeholder:"选择状态"})}),(0,t.jsxs)(x.gC,{children:[(0,t.jsx)(x.eb,{value:"enabled",children:"启用"}),(0,t.jsx)(x.eb,{value:"disabled",children:"禁用"})]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:F,children:"取消"}),(0,t.jsxs)(l.$,{onClick:O,disabled:F,children:[F&&(0,t.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}),"create"===n?"创建":"保存"]})]})]})})}let L=(0,k.createServerReference)("60848caaf6a6801d7ccac621f4b51da3d5f4f013c6",k.callServer,void 0,k.findSourceMapURL,"resetPassword");function _(e){let{open:s,onOpenChange:a,userId:n,username:i,onSuccess:c}=e,o=(0,y.useRouter)(),[x,h]=(0,r.useState)(""),[m,j]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),[v,g]=(0,r.useState)(""),[b,N]=(0,r.useState)(""),k=()=>{h(""),j(""),g(""),N("")},A=e=>e?e.length<8?(N("密码至少 8 位"),!1):/^(?=.*[A-Za-z])(?=.*\d)/.test(e)?(N(""),!0):(N("密码必须包含字母和数字"),!1):(N("密码不能为空"),!1),R=async()=>{if(g(""),A(x)){if(x!==m){N("两次密码不一致");return}f(!0);try{await L(n,x),z.o.success("密码重置成功"),k(),null==c||c(),a(!1),o.refresh()}catch(e){g(e.message||"密码重置失败，请重试")}finally{f(!1)}}},F=()=>{p||(k(),a(!1))};return(0,t.jsx)(w.lG,{open:s,onOpenChange:F,children:(0,t.jsxs)(w.Cf,{className:"sm:max-w-[425px]",children:[(0,t.jsxs)(w.c7,{children:[(0,t.jsx)(w.L3,{children:"重置密码"}),(0,t.jsxs)(w.rr,{children:["为用户 ",(0,t.jsx)("strong",{children:i})," 重置密码"]})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[v&&(0,t.jsx)(u.Fc,{variant:"destructive",children:(0,t.jsx)(u.TN,{children:v})}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"newPassword",children:["新密码 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(d.p,{id:"newPassword",type:"password",value:x,onChange:e=>{let s=e.target.value;h(s),A(s)},disabled:p,placeholder:"输入新密码（至少 8 位，包含字母和数字）",className:b?"border-red-500":""}),b&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:b})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(S.J,{htmlFor:"confirmPassword",children:["确认密码 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(d.p,{id:"confirmPassword",type:"password",value:m,onChange:e=>j(e.target.value),disabled:p,placeholder:"再次输入新密码",className:x!==m&&m?"border-red-500":""}),x!==m&&m&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:"两次密码不一致"})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(l.$,{type:"button",variant:"outline",onClick:F,disabled:p,children:"取消"}),(0,t.jsxs)(l.$,{onClick:R,disabled:p,children:[p&&(0,t.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}),"重置密码"]})]})]})})}var P=a(9286),U=a(2640),$=a(1466);function M(e){let{role:s}=e;return"admin"===s?(0,t.jsxs)(P.E,{variant:"default",className:"bg-blue-500 hover:bg-blue-600",children:[(0,t.jsx)(U.A,{className:"w-3 h-3 mr-1"}),"管理员"]}):(0,t.jsxs)(P.E,{variant:"secondary",className:"bg-gray-200 text-gray-700 hover:bg-gray-300",children:[(0,t.jsx)($.A,{className:"w-3 h-3 mr-1"}),"普通用户"]})}var Z=a(3239),E=a(5340);function J(e){let{status:s}=e;return"enabled"===s?(0,t.jsxs)(P.E,{variant:"outline",className:"border-green-500 text-green-700 bg-green-50",children:[(0,t.jsx)(Z.A,{className:"w-3 h-3 mr-1"}),"启用"]}):(0,t.jsxs)(P.E,{variant:"outline",className:"border-red-500 text-red-700 bg-red-50",children:[(0,t.jsx)(E.A,{className:"w-3 h-3 mr-1"}),"禁用"]})}var O=a(3473),q=a(853),V=a(2118),D=a(5686),H=a(6293),G=a(6764),T=a(6744);let W=(0,k.createServerReference)("40d90b667a1c649fc8c056c814bf2988a62d62a90e",k.callServer,void 0,k.findSourceMapURL,"queryUsers"),Y=(0,k.createServerReference)("40f2f05d0eb1c2a17389067ddddca1fb92fb401fc4",k.callServer,void 0,k.findSourceMapURL,"deleteUser");var B=a(821);function I(){var e,s;let{data:h}=(0,n.wV)(),{setLoading:m}=(0,B.M)(),[j,p]=(0,r.useState)([]),[f,y]=(0,r.useState)(!0),[w,S]=(0,r.useState)(0),[k,A]=(0,r.useState)(1),[R]=(0,r.useState)(10),[L,P]=(0,r.useState)(""),[U,$]=(0,r.useState)("all"),[Z,E]=(0,r.useState)("all"),[I,X]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(!1),[ee,es]=(0,r.useState)(!1),[ea,et]=(0,r.useState)(null),[er,en]=(0,r.useState)([]),[el,ed]=(0,r.useState)(!1);async function ei(){y(!0);try{let e=await W({page:k,pageSize:R,search:L||void 0,role:"all"!==U?U:void 0,status:"all"!==Z?Z:void 0});p(e.users),S(e.total)}catch(e){z.o.error(e.message||"获取用户列表失败")}finally{y(!1)}}async function ec(e){var s;if(e.id===(null==h?void 0:null===(s=h.user)||void 0===s?void 0:s.id)){z.o.error("不能删除当前登录用户");return}if(confirm('确定要删除用户 "'.concat(e.username,'" 吗？'))){m(!0,"正在删除用户...");try{await Y(e.id),z.o.success("用户删除成功"),ei()}catch(e){z.o.error(e.message||"删除用户失败")}finally{m(!1)}}}async function eo(e){var s;if(0===er.length){z.o.error("请先选择用户");return}if(er.includes((null==h?void 0:null===(s=h.user)||void 0===s?void 0:s.id)||"")&&"disabled"===e){z.o.error("不能禁用当前登录用户");return}ed(!0),m(!0,"正在批量".concat("enabled"===e?"启用":"禁用","用户..."));try{let{batchUpdateStatus:s}=await a.e(5620).then(a.bind(a,5620)),t=await s(er,e);z.o.success("批量".concat("enabled"===e?"启用":"禁用","成功：").concat(t.successCount," 个用户")),en([]),ei()}catch(e){z.o.error(e.message||"批量操作失败")}finally{ed(!1),m(!1)}}async function eu(){var e;if(0===er.length){z.o.error("请先选择用户");return}if(er.includes((null==h?void 0:null===(e=h.user)||void 0===e?void 0:e.id)||"")){z.o.error("不能删除当前登录用户");return}if(confirm("确定要删除选中的 ".concat(er.length," 个用户吗？此操作不可撤销。"))){ed(!0),m(!0,"正在批量删除用户...");try{let{batchDeleteUsers:e}=await a.e(5620).then(a.bind(a,5620)),s=await e(er);z.o.success("批量删除成功：".concat(s.successCount," 个用户")),en([]),ei()}catch(e){z.o.error(e.message||"批量删除失败")}finally{ed(!1),m(!1)}}}(0,r.useEffect)(()=>{(null==h?void 0:h.user)&&ei()},[h,k,L,U,Z]);let ex=Math.ceil(w/R);return(null==h?void 0:null===(e=h.user)||void 0===e?void 0:e.role)!=="admin"&&(null==h?void 0:null===(s=h.user)||void 0===s?void 0:s.role)!=="管理员"?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(u.Fc,{variant:"destructive",className:"max-w-md",children:(0,t.jsx)(u.TN,{children:"您没有访问此页面的权限。用户管理功能仅对管理员开放。"})})}):f&&0===j.length?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(C.A,{className:"h-8 w-8 animate-spin text-gray-500"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"用户权限管理"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"管理系统用户和权限"})]}),(0,t.jsxs)(l.$,{onClick:function(){X(!0)},children:[(0,t.jsx)(O.A,{className:"mr-2 h-4 w-4"}),"新增用户"]})]}),(0,t.jsx)(o.Zp,{children:(0,t.jsx)(o.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(q.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),(0,t.jsx)(d.p,{placeholder:"搜索用户名...",value:L,onChange:e=>{P(e.target.value),A(1)},className:"pl-10"})]})}),(0,t.jsxs)(x.l6,{value:U,onValueChange:e=>{$(e),A(1)},children:[(0,t.jsx)(x.bq,{className:"w-[150px]",children:(0,t.jsx)(x.yv,{placeholder:"角色"})}),(0,t.jsxs)(x.gC,{children:[(0,t.jsx)(x.eb,{value:"all",children:"全部角色"}),(0,t.jsx)(x.eb,{value:"admin",children:"管理员"}),(0,t.jsx)(x.eb,{value:"user",children:"普通用户"})]})]}),(0,t.jsxs)(x.l6,{value:Z,onValueChange:e=>{E(e),A(1)},children:[(0,t.jsx)(x.bq,{className:"w-[150px]",children:(0,t.jsx)(x.yv,{placeholder:"状态"})}),(0,t.jsxs)(x.gC,{children:[(0,t.jsx)(x.eb,{value:"all",children:"全部状态"}),(0,t.jsx)(x.eb,{value:"enabled",children:"启用"}),(0,t.jsx)(x.eb,{value:"disabled",children:"禁用"})]})]})]})})}),er.length>0&&(0,t.jsx)(o.Zp,{className:"border-blue-200 bg-blue-50",children:(0,t.jsx)(o.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{className:"text-sm text-blue-900",children:["已选择 ",(0,t.jsx)("strong",{children:er.length})," 个用户"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(l.$,{size:"sm",variant:"outline",onClick:()=>eo("enabled"),disabled:el,children:[(0,t.jsx)(V.A,{className:"mr-2 h-4 w-4"}),"批量启用"]}),(0,t.jsxs)(l.$,{size:"sm",variant:"outline",onClick:()=>eo("disabled"),disabled:el,children:[(0,t.jsx)(V.A,{className:"mr-2 h-4 w-4"}),"批量禁用"]}),(0,t.jsxs)(l.$,{size:"sm",variant:"destructive",onClick:eu,disabled:el,children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"}),"批量删除"]})]})]})})}),(0,t.jsxs)(o.Zp,{children:[(0,t.jsx)(o.aR,{children:(0,t.jsx)(o.ZB,{children:"用户列表"})}),(0,t.jsx)(o.Wu,{children:0===j.length?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"暂无用户"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(c.XI,{children:[(0,t.jsx)(c.A0,{children:(0,t.jsxs)(c.Hj,{children:[(0,t.jsx)(c.nd,{className:"w-[50px]",children:(0,t.jsx)(i.S,{checked:er.length>0&&er.length===j.length,onCheckedChange:e=>{e?en(j.map(e=>e.id)):en([])}})}),(0,t.jsx)(c.nd,{children:"用户名"}),(0,t.jsx)(c.nd,{children:"角色"}),(0,t.jsx)(c.nd,{children:"状态"}),(0,t.jsx)(c.nd,{children:"最后登录"}),(0,t.jsx)(c.nd,{children:"创建时间"}),(0,t.jsx)(c.nd,{className:"text-right",children:"操作"})]})}),(0,t.jsx)(c.BF,{children:j.map(e=>{var s;return(0,t.jsxs)(c.Hj,{children:[(0,t.jsx)(c.nA,{children:(0,t.jsx)(i.S,{checked:er.includes(e.id),onCheckedChange:s=>{var a;return a=e.id,void(s?en([...er,a]):en(er.filter(e=>e!==a)))}})}),(0,t.jsx)(c.nA,{className:"font-medium",children:e.username}),(0,t.jsx)(c.nA,{children:(0,t.jsx)(M,{role:e.role})}),(0,t.jsx)(c.nA,{children:(0,t.jsx)(J,{status:e.status})}),(0,t.jsx)(c.nA,{className:"text-gray-600",children:function(e){if(!e)return"从未登录";let s=new Date(e),a=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0"),n=String(s.getHours()).padStart(2,"0"),l=String(s.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(t,"-").concat(r," ").concat(n,":").concat(l)}(e.lastLoginAt)}),(0,t.jsx)(c.nA,{className:"text-gray-600",children:function(e){let s=new Date(e),a=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return"".concat(a,"-").concat(t,"-").concat(r)}(e.createdAt)}),(0,t.jsx)(c.nA,{className:"text-right",children:(0,t.jsxs)(v,{children:[(0,t.jsx)(g,{asChild:!0,children:(0,t.jsx)(l.$,{size:"sm",variant:"ghost",children:(0,t.jsx)(H.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(b,{align:"end",children:[(0,t.jsxs)(N,{onClick:()=>{et(e),Q(!0)},children:[(0,t.jsx)(G.A,{className:"mr-2 h-4 w-4"}),"编辑"]}),(0,t.jsxs)(N,{onClick:()=>{et(e),es(!0)},children:[(0,t.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"重置密码"]}),(0,t.jsxs)(N,{onClick:()=>ec(e),className:"text-red-600",disabled:e.id===(null==h?void 0:null===(s=h.user)||void 0===s?void 0:s.id),children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"}),"删除"]})]})]})})]},e.id)})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["共 ",w," 个用户，第 ",k," / ",ex," 页"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.$,{size:"sm",variant:"outline",onClick:()=>A(k-1),disabled:k<=1,children:"上一页"}),(0,t.jsx)(l.$,{size:"sm",variant:"outline",onClick:()=>A(k+1),disabled:k>=ex,children:"下一页"})]})]})]})})]}),(0,t.jsx)(F,{open:I,onOpenChange:X,mode:"create",onSuccess:()=>{ei(),X(!1)}}),ea&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(F,{open:K,onOpenChange:Q,mode:"edit",initialData:ea,onSuccess:()=>{ei(),Q(!1),et(null)}}),(0,t.jsx)(_,{open:ee,onOpenChange:es,userId:ea.id,username:ea.username,onSuccess:()=>{es(!1),et(null)}})]})]})}},3670:(e,s,a)=>{"use strict";a.d(s,{S:()=>d});var t=a(5155);a(2115);var r=a(6352),n=a(8867),l=a(9602);function d(e){let{className:s,...a}=e;return(0,t.jsx)(r.bL,{"data-slot":"checkbox",className:(0,l.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:(0,t.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:(0,t.jsx)(n.A,{className:"size-3.5"})})})}},821:(e,s,a)=>{"use strict";a.d(s,{M:()=>d,o:()=>l});var t=a(5155),r=a(2115);let n=(0,r.createContext)(void 0);function l(e){let{children:s}=e,[a,l]=(0,r.useState)(!1),[d,i]=(0,r.useState)("处理中...");return(0,t.jsx)(n.Provider,{value:{isLoading:a,message:d,setLoading:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"处理中...";l(e),i(s)}},children:s})}function d(){let e=(0,r.useContext)(n);if(!e)throw Error("useLoading must be used within LoadingProvider");return e}}},e=>{var s=s=>e(e.s=s);e.O(0,[9406,2291,696,8348,814,7294,8240,650,8441,1517,7358],()=>s(6428)),_N_E=e.O()}]);