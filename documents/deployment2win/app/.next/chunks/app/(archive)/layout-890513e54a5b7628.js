(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1523],{9819:(e,t,r)=>{Promise.resolve().then(r.bind(r,9313))},9313:(e,t,r)=>{"use strict";r.d(t,{LoadingProviderWrapper:()=>A});var s=r(5155),n=r(821),i=r(4505);function a(){let{isLoading:e,message:t}=(0,n.M)();return e?(0,s.jsx)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 flex flex-col items-center gap-4 min-w-[200px]",children:[(0,s.jsx)(i.A,{className:"h-10 w-10 animate-spin text-blue-600"}),(0,s.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 font-medium",children:t})]})}):null}var l=r(2115),d=r(8173),o=r.n(d),c=r(6046),h=r(3394);let u=(0,h.A)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);var x=r(853),f=r(6308),m=r(8684),p=r(4081),y=r(2823);let g=(0,h.A)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var w=r(6967),j=r(3518);let v=(0,h.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var b=r(9602);let k=[{title:"数据看板",href:"/dashboard",icon:(0,s.jsx)(u,{size:20})},{title:"搜索",href:"/search",icon:(0,s.jsx)(x.A,{size:20})},{title:"档案管理",href:"/archives",icon:(0,s.jsx)(f.A,{size:20})},{title:"批量入库",href:"/import",icon:(0,s.jsx)(m.A,{size:20})},{title:"操作日志",href:"/logs",icon:(0,s.jsx)(p.A,{size:20})},{title:"用户管理",href:"/users",icon:(0,s.jsx)(y.A,{size:20}),admin:!0},{title:"许可证管理",href:"/licenses",icon:(0,s.jsx)(g,{size:20}),admin:!0}];function N(e){var t,r;let{username:i,role:a,userId:d}=e,[h,u]=(0,l.useState)(!1),[x,f]=(0,l.useState)(null),[m,p]=(0,l.useState)(null),[y,g]=(0,l.useState)(!1),[N,A]=(0,l.useState)(null),M=(0,c.usePathname)(),z=(0,l.useRef)(null),H=(0,l.useRef)(null),C=(0,l.useRef)(null),{setLoading:E}=(0,n.M)(),W="admin"===a||"管理员"===a,L=()=>{C.current&&(clearTimeout(C.current),C.current=null)},S=()=>{L(),C.current=setTimeout(()=>{g(!1)},150)},P=()=>{L(),g(!0)};(0,l.useEffect)(()=>()=>{L()},[]);let _=(e,t)=>{if(h){let r=t.currentTarget.getBoundingClientRect(),s=r.right+8,n=r.top;s+200>window.innerWidth-16&&(s=r.left-200-8),s<8&&(s=8),n+44>window.innerHeight-16&&(n=window.innerHeight-44-16),n<8&&(n=8),console.log("Menu item position:",{left:s,top:n,rect:r,windowWidth:window.innerWidth}),p({top:n,left:s}),f(e)}},R=()=>{f(null),p(null)},T=e=>{let t=e.currentTarget.getBoundingClientRect(),r=0,s=0;h?(r=t.right+8,s=t.top,r+180>window.innerWidth-16&&(r=t.left-180-8),s+120>window.innerHeight-16&&(s=window.innerHeight-120-16)):(r=t.left,s=t.bottom+8,r+180>window.innerWidth-16&&(r=window.innerWidth-180-16),s+120>window.innerHeight-16&&(s=t.top-120-8)),r<8&&(r=8),s<8&&(s=8),console.log("User menu position:",{collapsed:h,left:r,top:s,rect:t,windowWidth:window.innerWidth}),A({top:s,left:r}),P()},q=async()=>{E(!0,"正在退出...");try{if((await fetch("/api/auth/signout",{method:"POST"})).ok)window.location.href="/login";else throw Error("Signout failed")}catch(e){console.error("Logout failed:",e),window.location.href="/login"}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("aside",{ref:z,className:(0,b.cn)("bg-gray-900 text-white transition-all duration-300 flex flex-col h-screen",h?"w-16":"w-64"),children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between border-b border-gray-800",children:[!h&&(0,s.jsx)("h1",{className:"text-xl font-bold truncate",children:"档案管理系统"}),(0,s.jsx)("button",{onClick:()=>u(!h),className:"p-1 rounded hover:bg-gray-800 transition-colors flex-shrink-0","aria-label":h?"展开菜单":"收缩菜单",children:h?(0,s.jsx)(w.A,{size:20}):(0,s.jsx)(j.A,{size:20})})]}),(0,s.jsx)("nav",{className:"flex-1 py-4 overflow-y-auto",children:(0,s.jsx)("ul",{className:"space-y-1 px-2",children:k.map(e=>{if(e.admin&&!W)return null;let t=M===e.href||(null==M?void 0:M.startsWith(e.href+"/"));return(0,s.jsx)("li",{children:(0,s.jsxs)(o(),{href:e.href,className:(0,b.cn)("relative flex items-center px-3 py-2 rounded-md transition-colors",t?"bg-blue-600 text-white":"hover:bg-gray-800 text-gray-300",h&&"justify-center"),onMouseEnter:t=>_(e.href,t),onMouseLeave:R,children:[(0,s.jsx)("span",{className:"flex-shrink-0",children:e.icon}),!h&&(0,s.jsx)("span",{className:"ml-3 truncate",children:e.title})]})},e.href)})})}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-800",children:h?(0,s.jsx)("div",{ref:H,className:"flex justify-center cursor-pointer hover:bg-gray-800 -mx-4 px-4 py-2 transition-colors rounded-md",onMouseEnter:T,onMouseLeave:S,children:(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-sm font-medium",children:i.charAt(0).toUpperCase()})})}):(0,s.jsx)("div",{ref:H,className:"flex items-center justify-between cursor-pointer hover:bg-gray-800 -mx-4 px-4 py-2 transition-colors rounded-md",onMouseEnter:T,onMouseLeave:S,children:(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-sm font-medium",children:i.charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",children:i}),(0,s.jsx)("p",{className:"text-xs text-gray-400 truncate",children:"admin"===a?"管理员":"用户"})]})]})})})]}),h&&x&&m&&(0,s.jsxs)("div",{className:"fixed px-4 py-2 bg-gray-800 text-white rounded-md shadow-lg z-50 flex items-center gap-3 whitespace-nowrap pointer-events-none",style:{top:"".concat(m.top,"px"),left:"".concat(m.left+8,"px")},children:[null===(t=k.find(e=>e.href===x))||void 0===t?void 0:t.icon,(0,s.jsx)("span",{children:null===(r=k.find(e=>e.href===x))||void 0===r?void 0:r.title})]}),y&&N&&(0,s.jsxs)("div",{className:"fixed bg-white rounded-lg shadow-lg py-2 z-50 min-w-[160px]",style:{top:"".concat(N.top,"px"),left:"".concat(N.left,"px")},onMouseEnter:P,onMouseLeave:S,children:[(0,s.jsxs)("div",{className:"px-4 py-2 border-b border-gray-100",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:i}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"admin"===a?"管理员":"用户"})]}),(0,s.jsxs)("button",{className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors",onClick:q,children:[(0,s.jsx)(v,{size:16}),(0,s.jsx)("span",{children:"退出登录"})]})]})]})}function A(e){let{username:t,role:r,userId:i,children:l}=e;return(0,s.jsxs)(n.o,{children:[(0,s.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,s.jsxs)("div",{className:"flex h-screen",children:[(0,s.jsx)(N,{username:t,role:r,userId:i}),(0,s.jsx)("div",{className:"flex-1 flex flex-col",children:(0,s.jsx)("main",{className:"flex-1 overflow-auto p-6",children:l})})]})}),(0,s.jsx)(a,{})]})}},821:(e,t,r)=>{"use strict";r.d(t,{M:()=>l,o:()=>a});var s=r(5155),n=r(2115);let i=(0,n.createContext)(void 0);function a(e){let{children:t}=e,[r,a]=(0,n.useState)(!1),[l,d]=(0,n.useState)("处理中...");return(0,s.jsx)(i.Provider,{value:{isLoading:r,message:l,setLoading:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"处理中...";a(e),d(t)}},children:t})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useLoading must be used within LoadingProvider");return e}},9602:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var s=r(3463),n=r(9795);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.QP)((0,s.$)(t))}},3518:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},6967:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},4081:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},6308:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]])},4505:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},853:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},8684:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},2823:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(3394).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[9406,1028,8441,1517,7358],()=>t(9819)),_N_E=e.O()}]);