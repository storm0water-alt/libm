(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5483],{4551:(e,s,a)=>{Promise.resolve().then(a.bind(a,2228))},2228:(e,s,a)=>{"use strict";a.d(s,{ConfigManagementClient:()=>Z});var t=a(5155),l=a(2115),r=a(6046),i=a(4085),n=a(2336),c=a(745),d=a(5007),o=a(9286),x=a(2079),u=a(8236),h=a(8686),m=a(4947),j=a(6764),p=a(5686);function g(e){let{configs:s,onEdit:a,onDelete:l,onViewHistory:r,total:n,currentPage:c,totalPages:g,onPageChange:f}=e,N=s.reduce((e,s)=>(e[s.group]||(e[s.group]=[]),e[s.group].push(s),e),{}),v=Object.keys(N).sort(),y=e=>{switch(e){case"string":default:return"default";case"number":return"secondary";case"boolean":return"outline";case"json":return"destructive"}},b=e=>{switch(e){case"string":return"字符串";case"number":return"数字";case"boolean":return"布尔值";case"json":return"JSON";default:return e}},S=e=>{let{configValue:s,configType:a}=e;switch(a){case"boolean":return"true"===s?"是":"否";case"json":try{let e=JSON.parse(s);if("object"==typeof e)return"[".concat(Object.keys(e).length," 个字段]");return s}catch(e){return s}default:if(s.length>50)return"".concat(s.substring(0,50),"...");return s}};return(0,t.jsxs)("div",{className:"space-y-6",children:[v.map(e=>(0,t.jsxs)(d.Zp,{children:[(0,t.jsx)(d.aR,{children:(0,t.jsxs)(d.ZB,{className:"text-lg flex items-center gap-2",children:[(0,t.jsx)(u.A,{className:"h-5 w-5 text-gray-600"}),"分组: ",e,(0,t.jsx)(o.E,{variant:"secondary",className:"ml-2",children:N[e].length})]})}),(0,t.jsx)(d.Wu,{children:(0,t.jsxs)(x.XI,{children:[(0,t.jsx)(x.A0,{children:(0,t.jsxs)(x.Hj,{children:[(0,t.jsx)(x.nd,{className:"w-[200px]",children:"配置键"}),(0,t.jsx)(x.nd,{className:"w-[150px]",children:"配置值"}),(0,t.jsx)(x.nd,{className:"w-[100px]",children:"类型"}),(0,t.jsx)(x.nd,{children:"描述"}),(0,t.jsx)(x.nd,{className:"w-[120px]",children:"更新时间"}),(0,t.jsx)(x.nd,{className:"text-right w-[180px]",children:"操作"})]})}),(0,t.jsx)(x.BF,{children:N[e].map(e=>(0,t.jsxs)(x.Hj,{children:[(0,t.jsx)(x.nA,{className:"font-medium",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-mono text-sm",children:e.configKey}),e.isSystem&&(0,t.jsx)(h.A,{className:"h-3 w-3 text-gray-400",title:"系统保留配置"})]})}),(0,t.jsx)(x.nA,{children:(0,t.jsx)("span",{className:"font-mono text-sm text-gray-600",children:S(e)})}),(0,t.jsx)(x.nA,{children:(0,t.jsx)(o.E,{variant:y(e.configType),children:b(e.configType)})}),(0,t.jsx)(x.nA,{className:"text-gray-600",children:e.description||"-"}),(0,t.jsx)(x.nA,{className:"text-sm text-gray-600",children:new Date(e.updatedAt).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),(0,t.jsx)(x.nA,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,t.jsx)(i.$,{size:"icon-xs",variant:"ghost",onClick:()=>r(e.configKey),title:"查看历史",children:(0,t.jsx)(m.A,{className:"h-3 w-3"})}),(0,t.jsx)(i.$,{size:"icon-xs",variant:"ghost",onClick:()=>a(e),title:"编辑",children:(0,t.jsx)(j.A,{className:"h-3 w-3"})}),!e.isSystem&&(0,t.jsx)(i.$,{size:"icon-xs",variant:"ghost",onClick:()=>l(e.configKey),title:"删除",children:(0,t.jsx)(p.A,{className:"h-3 w-3 text-destructive"})})]})})]},e.id))})]})})]},e)),g>1&&(0,t.jsx)(d.Zp,{children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["显示 ",(c-1)*20+1," -"," ",Math.min(20*c,n)," / ",n]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.$,{size:"sm",variant:"outline",disabled:1===c,onClick:()=>f(c-1),children:"上一页"}),(0,t.jsx)("div",{className:"flex items-center px-3",children:(0,t.jsxs)("span",{className:"text-sm",children:["第 ",c," / ",g," 页"]})}),(0,t.jsx)(i.$,{size:"sm",variant:"outline",disabled:c>=g,onClick:()=>f(c+1),children:"下一页"})]})]})})})]})}var f=a(7837),N=a(5785),v=a(5828);let y=(0,v.createServerReference)("4055794adef7046140349367cd9cdba78d01d33f8d",v.callServer,void 0,v.findSourceMapURL,"updateConfigAction"),b=(0,v.createServerReference)("40f236a78030193cbd38ef247fa793dbab391c62fc",v.callServer,void 0,v.findSourceMapURL,"createConfigAction");function S(e){let{open:s,onOpenChange:a,onSuccess:r,groups:d,config:o}=e,x=!!o,[h,m]=(0,l.useState)((null==o?void 0:o.configKey)||""),[j,p]=(0,l.useState)((null==o?void 0:o.configValue)||""),[g,v]=(0,l.useState)((null==o?void 0:o.configType)||"string"),[S,w]=(0,l.useState)((null==o?void 0:o.description)||""),[C,A]=(0,l.useState)((null==o?void 0:o.group)||"default"),[k,O]=(0,l.useState)(!1),[F,J]=(0,l.useState)(""),[_,E]=(0,l.useState)("");(0,l.useEffect)(()=>{s&&(o?(m(o.configKey),p(o.configValue),v(o.configType),w(o.description||""),A(o.group)):(m(""),p(""),v("string"),w(""),A("default")),J(""),E(""))},[s,o]);let z=e=>e?e.length>100?(E("配置键不能超过100个字符"),!1):/^[a-zA-Z0-9._-]+$/.test(e)?(E(""),!0):(E("配置键只能包含字母、数字、点、下划线和连字符"),!1):(E("配置键不能为空"),!1),R=e=>{m(e),x||z(e)},$=(e,s)=>{switch(s){case"number":if(isNaN(Number(e)))return J("配置值必须是数字"),!1;break;case"boolean":if("true"!==e&&"false"!==e)return J("配置值必须是 true 或 false"),!1;break;case"json":try{JSON.parse(e)}catch(e){return J("配置值必须是有效的 JSON 格式"),!1}}return J(""),!0},L=e=>{p(e),$(e,g)},T=async e=>{if(e.preventDefault(),(x||z(h))&&$(j,g)){if(S&&S.length>500){J("描述不能超过500个字符");return}if(C.length>50){J("分组名称不能超过50个字符");return}O(!0),J("");try{let e;(e=x?await y({configKey:o.configKey,configValue:j,configType:g}):await b({configKey:h,configValue:j,configType:g,description:S,group:C})).success?(r(),a(!1)):J(e.error||"操作失败")}catch(e){console.error("Failed to save config:",e),J("操作失败，请重试")}finally{O(!1)}}};return(0,t.jsx)(f.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(f.Cf,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(f.c7,{children:[(0,t.jsxs)(f.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(u.A,{className:"h-5 w-5"}),x?"编辑配置":"新增配置"]}),(0,t.jsx)(f.rr,{children:x?"修改配置值和描述信息":"创建新的系统配置项"})]}),(0,t.jsxs)("form",{onSubmit:T,children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(N.J,{htmlFor:"configKey",children:["配置键 ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsx)(n.p,{id:"configKey",value:h,onChange:e=>R(e.target.value),placeholder:"例如: system.name",disabled:x,className:_?"border-destructive":""}),_&&(0,t.jsx)("p",{className:"text-sm text-destructive",children:_}),!x&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"配置键创建后不可修改，只能包含字母、数字、点、下划线和连字符"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(N.J,{htmlFor:"configValue",children:["配置值 ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),"json"===g?(0,t.jsx)("textarea",{id:"configValue",value:j,onChange:e=>L(e.target.value),placeholder:'{"key": "value"}',className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"}):(0,t.jsx)(n.p,{id:"configValue",value:j,onChange:e=>L(e.target.value),placeholder:"输入配置值",type:"number"===g?"number":"text"}),"boolean"===g&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"请输入 true 或 false"}),"json"===g&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"请输入有效的 JSON 格式"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(N.J,{htmlFor:"configType",children:["配置类型 ",(0,t.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,t.jsxs)(c.l6,{value:g,onValueChange:e=>{if(v(e),j)switch(e){case"boolean":p("true");break;case"number":let s=Number(j);isNaN(s)?p("0"):p(s.toString());break;case"json":try{JSON.parse(j)}catch(e){p(JSON.stringify({value:j}))}}J("")},disabled:x,children:[(0,t.jsx)(c.bq,{id:"configType",children:(0,t.jsx)(c.yv,{})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"string",children:"字符串"}),(0,t.jsx)(c.eb,{value:"number",children:"数字"}),(0,t.jsx)(c.eb,{value:"boolean",children:"布尔值"}),(0,t.jsx)(c.eb,{value:"json",children:"JSON"})]})]}),x&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"配置类型创建后不可修改"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(N.J,{htmlFor:"group",children:"分组"}),x?(0,t.jsx)(n.p,{id:"group",value:C,disabled:!0,className:"bg-muted"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(c.l6,{value:C,onValueChange:A,children:[(0,t.jsx)(c.bq,{id:"group",children:(0,t.jsx)(c.yv,{})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"default",children:"默认"}),d.map(e=>(0,t.jsx)(c.eb,{value:e,children:e},e)),(0,t.jsx)(c.eb,{value:"__custom__",children:"自定义..."})]})]}),"__custom__"===C&&(0,t.jsx)(n.p,{value:"__custom__"===C?"":C,onChange:e=>A(e.target.value),placeholder:"输入分组名称",className:"mt-2"})]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(N.J,{htmlFor:"description",children:"描述"}),(0,t.jsx)(n.p,{id:"description",value:S,onChange:e=>w(e.target.value),placeholder:"配置项说明（可选）"})]}),F&&(0,t.jsx)("div",{className:"rounded-md bg-destructive/10 p-3",children:(0,t.jsx)("p",{className:"text-sm text-destructive",children:F})})]}),(0,t.jsxs)(f.Es,{children:[(0,t.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:k,children:"取消"}),(0,t.jsx)(i.$,{type:"submit",disabled:k,children:k?"保存中...":x?"保存":"创建"})]})]})]})})}var w=a(9677);v.callServer,v.findSourceMapURL;let C=(0,v.createServerReference)("403dee999aa5d59fb971821b9f022670f9bfa3d8aa",v.callServer,void 0,v.findSourceMapURL,"importConfigsAction");var A=a(4857),k=a(8684),O=a(6546),F=a(6336),J=a(1594);function _(e){let{open:s,onOpenChange:a}=e,[r,n]=(0,l.useState)("export"),[c,d]=(0,l.useState)(!1),[o,x]=(0,l.useState)(""),[u,h]=(0,l.useState)(null),m=(0,l.useRef)(null),j=async e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(a){d(!0),x(""),h(null);try{let e=await a.text(),s=JSON.parse(e);if(!Array.isArray(s)){x("配置文件格式错误：必须是数组");return}let t=await C(s);t.success?(h(t.data),m.current&&(m.current.value="")):x(t.error||"导入失败")}catch(e){console.error("Failed to import configs:",e),e instanceof SyntaxError?x("配置文件格式错误：无效的 JSON"):x("导入失败，请重试")}finally{d(!1)}}},p=e=>{n(e),x(""),h(null)};return(0,t.jsx)(f.lG,{open:s,onOpenChange:e=>{e&&(n("export"),x(""),h(null)),a(e)},children:(0,t.jsxs)(f.Cf,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(f.c7,{children:[(0,t.jsx)(f.L3,{children:"export"===r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.A,{className:"inline mr-2 h-5 w-5"}),"导出配置"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.A,{className:"inline mr-2 h-5 w-5"}),"导入配置"]})}),(0,t.jsx)(f.rr,{children:"export"===r?"将所有系统配置导出为 JSON 文件":"从 JSON 文件导入系统配置"})]}),(0,t.jsxs)("div",{className:"py-4",children:["export"===r?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(w.Fc,{children:[(0,t.jsx)(O.A,{className:"h-4 w-4"}),(0,t.jsx)(w.TN,{children:"导出将生成一个包含所有当前系统配置的 JSON 文件。该文件可用于备份或在其他环境中导入配置。"})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[(0,t.jsx)("p",{children:"导出内容包括："}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,t.jsx)("li",{children:"配置键"}),(0,t.jsx)("li",{children:"配置值"}),(0,t.jsx)("li",{children:"配置类型"}),(0,t.jsx)("li",{children:"描述信息"}),(0,t.jsx)("li",{children:"分组"})]})]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(w.Fc,{children:[(0,t.jsx)(O.A,{className:"h-4 w-4"}),(0,t.jsx)(w.TN,{children:"选择一个之前导出的 JSON 配置文件。已存在的配置键将被跳过，不会覆盖现有配置。"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(N.J,{htmlFor:"configFile",children:"选择配置文件"}),(0,t.jsx)("input",{ref:m,id:"configFile",type:"file",accept:".json",onChange:j,disabled:c,className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:mr-4 file:cursor-pointer file:border-0 file:bg-secondary file:px-4 file:py-1 file:text-sm file:font-medium hover:file:bg-secondary/80 disabled:cursor-not-allowed disabled:opacity-50"})]}),u&&(0,t.jsxs)(w.Fc,{children:[(0,t.jsx)(F.A,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)(w.TN,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"font-medium",children:"导入完成"}),(0,t.jsxs)("ul",{className:"text-sm space-y-1",children:[(0,t.jsxs)("li",{children:["成功导入: ",u.success," 条"]}),(0,t.jsxs)("li",{children:["跳过已存在: ",u.skipped," 条"]}),u.failed>0&&(0,t.jsxs)("li",{className:"text-destructive",children:["失败: ",u.failed," 条"]})]})]})})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground space-y-2",children:[(0,t.jsx)("p",{className:"font-medium",children:"导入规则："}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,t.jsx)("li",{children:"仅新增不存在的配置"}),(0,t.jsx)("li",{children:"已存在的配置将被跳过"}),(0,t.jsx)("li",{children:"系统保留配置不会被导入"}),(0,t.jsx)("li",{children:"单次最多导入 1000 条配置"})]})]})]}),o&&(0,t.jsxs)(w.Fc,{variant:"destructive",children:[(0,t.jsx)(J.A,{className:"h-4 w-4"}),(0,t.jsx)(w.TN,{children:o})]})]}),(0,t.jsx)(f.Es,{children:(0,t.jsxs)("div",{className:"flex gap-2 w-full justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(i.$,{type:"button",variant:"export"===r?"default":"outline",onClick:()=>p("export"),disabled:c,children:[(0,t.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"导出"]}),(0,t.jsxs)(i.$,{type:"button",variant:"import"===r?"default":"outline",onClick:()=>p("import"),disabled:c,className:"ml-2",children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"}),"导入"]})]}),(0,t.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:c,children:"关闭"})]})})]})})}let E=(0,v.createServerReference)("40e9d35017c1788a4d4e5392b3f8f8d4318c340099",v.callServer,void 0,v.findSourceMapURL,"getConfigHistoryAction");var z=a(6889),R=a(1466),$=a(9053);function L(e){let{open:s,onOpenChange:a,configKey:r}=e,[i,n]=(0,l.useState)([]),[c,x]=(0,l.useState)(!1),[u,h]=(0,l.useState)("");(0,l.useEffect)(()=>{s&&r&&j()},[s,r]);let j=async()=>{x(!0),h("");try{let e=await E(r);e.success?n(e.data):h(e.error||"加载历史记录失败")}catch(e){console.error("Failed to fetch config history:",e),h("加载历史记录失败")}finally{x(!1)}},p=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),g=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return e.length<=s?e:"".concat(e.substring(0,s),"...")};return(0,t.jsx)(f.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(f.Cf,{className:"sm:max-w-[700px] max-h-[80vh] overflow-hidden flex flex-col",children:[(0,t.jsxs)(f.c7,{children:[(0,t.jsxs)(f.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-5 w-5"}),"配置变更历史"]}),(0,t.jsxs)(f.rr,{children:["配置键: ",(0,t.jsx)("span",{className:"font-mono font-medium",children:r})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:c?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"加载中..."})]})}):u?(0,t.jsx)(d.Zp,{className:"border-destructive",children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsx)("p",{className:"text-destructive text-sm text-center",children:u})})}):0===i.length?(0,t.jsx)(d.Zp,{children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(m.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:"暂无修改历史"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"该配置从未被修改过"})]})})}):(0,t.jsx)("div",{className:"space-y-3",children:i.map((e,s)=>(0,t.jsx)(d.Zp,{className:0===s?"border-primary":"",children:(0,t.jsx)(d.Wu,{className:"pt-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(0===s?"bg-primary":"bg-gray-300")}),s<i.length-1&&(0,t.jsx)("div",{className:"w-0.5 h-full bg-gray-200 mt-1"})]}),(0,t.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,t.jsx)(o.E,{variant:0===s?"default":"secondary",className:"text-xs",children:0===s?"最新":"第 ".concat(s+1," 次")}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,t.jsx)(z.A,{className:"h-3 w-3"}),p(e.createdAt)]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,t.jsx)(R.A,{className:"h-3 w-3"}),e.operator]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"旧值"}),(0,t.jsx)("div",{className:"bg-muted p-2 rounded font-mono text-xs break-all",children:e.oldValue?(0,t.jsx)("span",{className:"line-through text-muted-foreground",children:g(e.oldValue)}):(0,t.jsx)("span",{className:"text-muted-foreground italic",children:"(初始值)"})})]}),(0,t.jsx)($.A,{className:"h-4 w-4 text-muted-foreground mt-6 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"新值"}),(0,t.jsx)("div",{className:"p-2 rounded font-mono text-xs break-all ".concat(0===s?"bg-primary/10 border border-primary/20":"bg-green-50 dark:bg-green-950"),children:g(e.newValue)})]})]})]})]})})},e.id))})}),!c&&!u&&i.length>0&&(0,t.jsx)("div",{className:"border-t pt-4",children:(0,t.jsxs)("p",{className:"text-sm text-muted-foreground text-center",children:["共 ",i.length," 条修改记录"]})})]})})}let T=(0,v.createServerReference)("400e6b2d29fed6252c01e4c4d0967c7030c0dcfb6b",v.callServer,void 0,v.findSourceMapURL,"queryConfigsAction");var V=a(3473);function Z(e){let{initialConfigs:s,initialGroups:a,initialPage:o,initialGroup:x,initialSearch:h}=e,m=(0,r.useRouter)();(0,r.useSearchParams)();let[j,p]=(0,l.useState)(s),[f]=(0,l.useState)(a),[N,v]=(0,l.useState)(x||""),[y,b]=(0,l.useState)(h||""),[w,C]=(0,l.useState)(o),[O,F]=(0,l.useState)(!1),[J,E]=(0,l.useState)(""),[z,R]=(0,l.useState)(!1),[$,Z]=(0,l.useState)(!1),[K,W]=(0,l.useState)(null),[M,P]=(0,l.useState)(!1),[U,D]=(0,l.useState)(!1),[q,H]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=new URLSearchParams;N&&e.set("group",N),y&&e.set("search",y),w>1&&e.set("page",w.toString());let s=e.toString();m.push(s?"/config?".concat(s):"/config")},[N,y,w,m]),(0,l.useEffect)(()=>{(async()=>{F(!0),E("");try{let e=await T({page:w,pageSize:20,group:N||void 0,search:y||void 0});e.success?p(e.data):E(e.error||"加载配置失败")}catch(e){console.error("Failed to fetch configs:",e),E("加载配置失败")}finally{F(!1)}})()},[w,N,y]);let G=async()=>{let e=await T({page:w,pageSize:20,group:N||void 0,search:y||void 0});e.success&&p(e.data),R(!1)},B=async()=>{let e=await T({page:w,pageSize:20,group:N||void 0,search:y||void 0});e.success&&p(e.data),Z(!1),W(null)},I=async e=>{if(confirm("确定要删除这个配置吗？"))try{let s=await fetch("/api/config",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({configKey:e})}),a=await s.json();if(a.success){let e=await T({page:w,pageSize:20,group:N||void 0,search:y||void 0});e.success&&p(e.data)}else E(a.error||"删除配置失败")}catch(e){console.error("Failed to delete config:",e),E("删除配置失败")}},X=e=>{b(e),C(1)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Zp,{children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{className:"flex flex-1 gap-2",children:[(0,t.jsx)(n.p,{placeholder:"搜索配置键或描述...",value:y,onChange:e=>X(e.target.value),className:"max-w-sm"}),(0,t.jsxs)(c.l6,{value:N||"all",onValueChange:e=>{v("all"===e?"":e),C(1)},children:[(0,t.jsx)(c.bq,{className:"w-[180px]",children:(0,t.jsx)(c.yv,{placeholder:"选择分组"})}),(0,t.jsxs)(c.gC,{children:[(0,t.jsx)(c.eb,{value:"all",children:"全部分组"}),f.map(e=>(0,t.jsx)(c.eb,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>P(!0),children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"}),"导入"]}),(0,t.jsxs)(i.$,{variant:"outline",size:"sm",onClick:()=>P(!0),children:[(0,t.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"导出"]}),(0,t.jsxs)(i.$,{size:"sm",onClick:()=>R(!0),children:[(0,t.jsx)(V.A,{className:"mr-2 h-4 w-4"}),"新增配置"]})]})]})})}),J&&(0,t.jsx)(d.Zp,{className:"border-destructive",children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsx)("p",{className:"text-destructive text-sm",children:J})})}),!O&&j&&(0,t.jsx)(g,{configs:j.items,onEdit:e=>{W(e),Z(!0)},onDelete:I,onViewHistory:e=>{H(e),D(!0)},total:j.total,currentPage:j.currentPage,totalPages:j.totalPages,onPageChange:e=>{C(e)}}),O&&(0,t.jsx)(d.Zp,{children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"加载中..."})})}),!O&&j&&0===j.items.length&&(0,t.jsx)(d.Zp,{children:(0,t.jsx)(d.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,t.jsx)(u.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("p",{className:"text-lg font-medium",children:"暂无配置"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:N||y?"未找到匹配的配置":'点击"新增配置"按钮创建第一个配置'})]})})}),(0,t.jsx)(S,{open:z,onOpenChange:R,onSuccess:G,groups:f}),(0,t.jsx)(S,{open:$,onOpenChange:Z,onSuccess:B,groups:f,config:K}),(0,t.jsx)(_,{open:M,onOpenChange:P}),(0,t.jsx)(L,{open:U,onOpenChange:D,configKey:q})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9406,2291,8348,5381,650,8441,1517,7358],()=>s(4551)),_N_E=e.O()}]);